version: 2.1

setup: true

orbs: 
  continuation: circleci/continuation@0.2.0
  jq: circleci/jq@2.2.0

parameters:
  changesTrue:
    type: boolean
    default: false

jobs:
  getChanges:
    executor: continuation/default
    steps:
      - checkout
      - jq/install      
      - run: 
          name: Check API for Scheduled Pipeline trigger type also pull id for next step
          command: |
            echo CIRCLE_SHA1
            LAST_SHA_REVISION = $(curl -H "Circle-Token: 5379bbe97c10bae1a6944cd25fad6ac076ed84d8" 'https://circleci.com/api/v2/project/github/jkzilla/cci-demo101b/pipeline?branch=master' | jq -r '.items[] | select(.state == "created" ) | select(.trigger.type == "scheduled_pipeline") | .vcs.revision')
            echo $LAST_SHA_REVISION 
            # compare to sha envvar of current build 
            # if they are the same then you circleci step halt

workflows:
  version: 2
  runDeployIfChangesTrue:
    when: << pipeline.parameters.changesTrue >>
    jobs:
      - getChanges
